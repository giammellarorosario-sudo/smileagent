<!DOCTYPE html>
<html lang="it">
<head>
  <%- include('../partials/head') %>
</head>
<body class="font-display bg-background-light dark:bg-background-dark">
<div class="relative flex min-h-screen w-full">
  <%- include('../partials/sidebar', {currentPage: 'dashboard', studioNome: studioNome}) %>

  <main class="flex-1 p-6 md:p-10 overflow-y-auto bg-gray-50 dark:bg-background-dark">
    <div class="max-w-7xl mx-auto">
      <!-- Header - ENHANCED -->
      <div class="mb-10 fade-in">
        <div class="flex items-center justify-between mb-6">
          <div>
            <h1 class="text-4xl font-black text-gray-900 dark:text-white mb-2 tracking-tight">Dashboard</h1>
            <p class="text-gray-600 dark:text-gray-400 text-lg">Panoramica generale del tuo studio</p>
          </div>
          <div class="flex items-center gap-3">
            <button class="btn h-11 px-5 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white hover:border-primary inline-flex items-center gap-2 shadow-sm">
              <span class="material-symbols-outlined text-lg">tune</span>
              <span class="text-sm font-semibold">Filtra</span>
            </button>
            <a href="/pazienti/new" class="btn btn-primary h-11 px-5 text-sm font-bold shadow-md hover:shadow-lg inline-flex items-center gap-2">
              <span class="material-symbols-outlined text-lg">add</span>
              <span>Nuovo Paziente</span>
            </a>
          </div>
        </div>
      </div>

      <!-- Stats Cards - ELITE DESIGN -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10 stagger-children">
        <!-- Total Pazienti - ELITE CARD -->
        <div class="card stat-card group cursor-pointer">
          <div class="flex items-start justify-between mb-4">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="material-symbols-outlined text-primary text-2xl fill">group</span>
            </div>
            <div class="badge badge-success">
              <span class="material-symbols-outlined text-xs mr-1">trending_up</span>
              +12%
            </div>
          </div>
          <h3 class="stat-value text-4xl mb-1"><%= stats.totalPazienti %></h3>
          <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Pazienti Totali</p>
          <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-800">
            <p class="text-xs text-gray-500 dark:text-gray-500">+15 questo mese</p>
          </div>
        </div>

        <!-- Appuntamenti Oggi - ELITE CARD -->
        <div class="card stat-card group cursor-pointer">
          <div class="flex items-start justify-between mb-4">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-500/10 flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="material-symbols-outlined text-blue-600 text-2xl">today</span>
            </div>
            <div class="badge" style="background: rgba(59, 130, 246, 0.1); color: rgb(37, 99, 235);">Oggi</div>
          </div>
          <h3 class="stat-value text-4xl mb-1"><%= stats.appuntamentiOggi %></h3>
          <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Appuntamenti oggi</p>
          <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-800">
            <p class="text-xs text-gray-500 dark:text-gray-500">3 completati, 5 in attesa</p>
          </div>
        </div>

        <!-- Appuntamenti Settimana - ELITE CARD -->
        <div class="card stat-card group cursor-pointer">
          <div class="flex items-start justify-between mb-4">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500/20 to-purple-500/10 flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="material-symbols-outlined text-purple-600 text-2xl">calendar_month</span>
            </div>
            <div class="badge" style="background: rgba(168, 85, 247, 0.1); color: rgb(147, 51, 234);">Prossimi 7gg</div>
          </div>
          <h3 class="stat-value text-4xl mb-1"><%= stats.appuntamentiSettimana %></h3>
          <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Appuntamenti settimana</p>
          <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-800">
            <p class="text-xs text-gray-500 dark:text-gray-500">Media giornaliera: 3.2</p>
          </div>
        </div>

        <!-- Fatture Non Pagate - ELITE CARD -->
        <div class="card stat-card group cursor-pointer">
          <div class="flex items-start justify-between mb-4">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500/20 to-orange-500/10 flex items-center justify-center group-hover:scale-110 transition-transform">
              <span class="material-symbols-outlined text-orange-600 text-2xl">receipt_long</span>
            </div>
            <div class="badge badge-warning">
              <span class="material-symbols-outlined text-xs mr-1">schedule</span>
              Pending
            </div>
          </div>
          <h3 class="stat-value text-4xl mb-1">â‚¬<%= stats.importoNonPagato.toFixed(0) %></h3>
          <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Da incassare</p>
          <div class="mt-3 pt-3 border-t border-gray-100 dark:border-gray-800">
            <p class="text-xs text-gray-500 dark:text-gray-500"><%= stats.fattureNonPagate %> fatture in sospeso</p>
          </div>
        </div>
      </div>

      <!-- Grid Layout - PROFESSIONAL -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Prossimi Appuntamenti - ENHANCED -->
        <div class="lg:col-span-2 card">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                <span class="material-symbols-outlined text-primary text-xl">calendar_today</span>
              </div>
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Prossimi Appuntamenti</h2>
            </div>
            <a href="/calendario" class="text-sm font-semibold text-primary hover:text-primary-hover transition-colors flex items-center gap-1">
              <span>Vedi tutti</span>
              <span class="material-symbols-outlined text-sm">arrow_forward</span>
            </a>
          </div>
          <div class="space-y-3">
            <% if (prossimiAppuntamenti.length === 0) { %>
            <!-- Empty State - PROFESSIONAL -->
            <div class="empty-state py-12">
              <span class="material-symbols-outlined empty-state-icon text-6xl mx-auto mb-4 block">event_busy</span>
              <h3 class="empty-state-title">Nessun appuntamento</h3>
              <p class="empty-state-description">Non ci sono appuntamenti programmati per i prossimi giorni.</p>
              <a href="/calendario/new" class="btn btn-primary mt-4 inline-flex items-center gap-2">
                <span class="material-symbols-outlined text-lg">add</span>
                <span>Aggiungi Appuntamento</span>
              </a>
            </div>
            <% } else { %>
            <% prossimiAppuntamenti.forEach(app => {
              const dataOra = new Date(app.data_ora);
              const dataStr = dataOra.toLocaleDateString('it-IT', { day: '2-digit', month: 'short' });
              const oraStr = dataOra.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
            %>
            <div class="flex items-center gap-4 p-4 bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900 rounded-xl border border-gray-100 dark:border-gray-800 hover:border-primary/30 hover:shadow-md transition-all group cursor-pointer">
              <div class="flex-shrink-0 w-16 h-16 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10 flex flex-col items-center justify-center group-hover:scale-105 transition-transform">
                <p class="text-2xl font-black text-primary"><%= dataStr.split(' ')[0] %></p>
                <p class="text-xs text-primary/70 uppercase font-bold"><%= dataStr.split(' ')[1] %></p>
              </div>
              <div class="flex-1 min-w-0">
                <p class="font-bold text-gray-900 dark:text-white text-base mb-1"><%= app.nome %> <%= app.cognome %></p>
                <div class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-gray-400 text-sm">medical_services</span>
                  <p class="text-sm text-gray-600 dark:text-gray-400 truncate"><%= app.tipo_trattamento %></p>
                </div>
              </div>
              <div class="text-right flex-shrink-0">
                <div class="flex items-center gap-2 justify-end mb-1">
                  <span class="material-symbols-outlined text-primary text-sm">schedule</span>
                  <p class="font-bold text-gray-900 dark:text-white"><%= oraStr %></p>
                </div>
                <p class="text-xs text-gray-500 dark:text-gray-500"><%= app.durata_minuti %> minuti</p>
              </div>
            </div>
            <% }); %>
            <% } %>
          </div>
        </div>

        <!-- Ultimi Pazienti - ENHANCED -->
        <div class="card">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center">
                <span class="material-symbols-outlined text-primary text-xl fill">group</span>
              </div>
              <h2 class="text-xl font-bold text-gray-900 dark:text-white">Ultimi Pazienti</h2>
            </div>
            <a href="/pazienti" class="text-sm font-semibold text-primary hover:text-primary-hover transition-colors flex items-center gap-1">
              <span>Vedi tutti</span>
              <span class="material-symbols-outlined text-sm">arrow_forward</span>
            </a>
          </div>
          <div class="space-y-3">
            <% ultimiPazienti.forEach(paz => { %>
            <div class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-all group cursor-pointer">
              <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
                <span class="text-primary font-black text-base"><%= paz.nome.charAt(0) %><%= paz.cognome.charAt(0) %></span>
              </div>
              <div class="flex-1 min-w-0">
                <p class="font-semibold text-gray-900 dark:text-white truncate"><%= paz.nome %> <%= paz.cognome %></p>
                <div class="flex items-center gap-1 mt-0.5">
                  <span class="material-symbols-outlined text-gray-400 text-xs">call</span>
                  <p class="text-xs text-gray-600 dark:text-gray-400 truncate"><%= paz.telefono %></p>
                </div>
              </div>
              <span class="material-symbols-outlined text-gray-300 dark:text-gray-700 text-sm group-hover:text-primary transition-colors">arrow_forward</span>
            </div>
            <% }); %>
          </div>
        </div>
      </div>

      <!-- Quick Actions - ELITE CTA -->
      <div class="mt-10 relative overflow-hidden rounded-2xl bg-gradient-to-br from-primary via-primary to-purple-600 p-8 shadow-xl">
        <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9ImdyaWQiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTSA2MCAwIEwgMCAwIDAgNjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS1vcGFjaXR5PSIwLjEiIHN0cm9rZS13aWR0aD0iMSIvPjwvcGF0dGVybj48L2RlZnM+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmlkKSIvPjwvc3ZnPg==')] opacity-30"></div>
        <div class="relative z-10">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-12 h-12 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center">
              <span class="material-symbols-outlined text-white text-2xl">bolt</span>
            </div>
            <h2 class="text-2xl font-black text-white">Azioni Rapide</h2>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <a href="/chat" class="card-hover flex flex-col items-center gap-3 p-5 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm rounded-xl hover:bg-white dark:hover:bg-gray-900 transition-all shadow-lg group">
              <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center group-hover:scale-110 transition-transform">
                <span class="material-symbols-outlined text-primary text-2xl fill">smart_toy</span>
              </div>
              <span class="text-sm font-bold text-gray-900 dark:text-white text-center">Chat AI</span>
            </a>
            <a href="/pazienti/new" class="card-hover flex flex-col items-center gap-3 p-5 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm rounded-xl hover:bg-white dark:hover:bg-gray-900 transition-all shadow-lg group">
              <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-green-500/20 to-green-500/10 flex items-center justify-center group-hover:scale-110 transition-transform">
                <span class="material-symbols-outlined text-green-600 text-2xl">person_add</span>
              </div>
              <span class="text-sm font-bold text-gray-900 dark:text-white text-center">Nuovo Paziente</span>
            </a>
            <a href="/calendario/new" class="card-hover flex flex-col items-center gap-3 p-5 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm rounded-xl hover:bg-white dark:hover:bg-gray-900 transition-all shadow-lg group">
              <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-500/10 flex items-center justify-center group-hover:scale-110 transition-transform">
                <span class="material-symbols-outlined text-blue-600 text-2xl">event_available</span>
              </div>
              <span class="text-sm font-bold text-gray-900 dark:text-white text-center">Appuntamento</span>
            </a>
            <a href="/social" class="card-hover flex flex-col items-center gap-3 p-5 bg-white/90 dark:bg-gray-900/90 backdrop-blur-sm rounded-xl hover:bg-white dark:hover:bg-gray-900 transition-all shadow-lg group">
              <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500/20 to-purple-500/10 flex items-center justify-center group-hover:scale-110 transition-transform">
                <span class="material-symbols-outlined text-purple-600 text-2xl">auto_awesome</span>
              </div>
              <span class="text-sm font-bold text-gray-900 dark:text-white text-center">Crea Post</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
</body>
</html>
